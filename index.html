<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mobile Election Prototype</title>
  <!-- Google Fonts: Montserrat -->
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link 
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" 
    rel="stylesheet"
  >
  <style>
    /* ---------- Global Reset & Typography ---------- */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Montserrat', sans-serif;
      background: #f2f2f2;
      color: #333;
      min-height: 100vh;
      padding-bottom: 70px; /* room for bottom nav */
    }
    h1, h2, h3 { color: #333; }
    a { color: #2a9df4; text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* ---------- Mobile Container & Views ---------- */
    .view {
      display: none;
      padding: 15px;
    }
    .active { display: block; }
    .container {
      background: #fff;
      border-radius: 6px;
      padding: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin-bottom: 15px;
    }

    /* ---------- Bottom Navigation ---------- */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: #fff;
      border-top: 1px solid #ccc;
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 100;
    }
    .bottom-nav button {
      background: none;
      border: none;
      color: #666;
      font-size: 0.9rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
    }
    .bottom-nav button.active {
      color: #2a9df4;
    }
    .bottom-nav button svg {
      width: 24px;
      height: 24px;
      margin-bottom: 3px;
    }

    /* ---------- Button Styling ---------- */
    .btn {
      display: inline-block;
      padding: 10px 20px;
      background: #2a9df4;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
      margin: 5px 0;
    }
    .btn:hover { background: #1c7cd6; }

    /* ---------- Election Block ---------- */
    .election-block {
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 12px;
      margin-bottom: 10px;
      background: #fafafa;
      transition: background 0.2s, transform 0.2s;
    }
    .election-block:hover { 
      transform: translateY(-2px); 
      background: #f0f0f0;
    }
    .election-block h2 { font-weight: 700; margin-bottom: 8px; }

    /* ---------- Position Block ---------- */
    .position-block {
      margin-bottom: 15px;
    }
    .position-info { margin-bottom: 10px; }
    .position-nav { margin-top: 10px; }
    
    /* ---------- Candidate Blocks ---------- */
    .candidates {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .candidate-block {
      border: 1px solid #ddd;
      padding: 8px;
      border-radius: 4px;
      width: 120px;
      text-align: center;
      position: relative;
      cursor: pointer;
      background: #fff;
      transition: box-shadow 0.2s, transform 0.2s;
    }
    .candidate-block:hover { 
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
      transform: translateY(-2px);
    }
    .candidate-block img {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      margin-bottom: 5px;
      border: 1px solid #ccc;
    }
    .best-choice {
      position: absolute;
      top: 5px;
      right: 5px;
      background: #2a9df4;
      color: #fff;
      border-radius: 50%;
      padding: 2px 5px;
      font-size: 0.7rem;
      font-weight: bold;
    }

    /* ---------- Candidate Panel (Overlay) ---------- */
    .overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 200;
      padding: 15px;
    }
    .overlay.active { display: flex; }
    .candidate-panel {
      background: #fff;
      border-radius: 4px;
      padding: 15px;
      max-width: 600px;
      width: 100%;
      position: relative;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .candidate-panel img {
      width: 100%;
      max-height: 200px;
      object-fit: cover;
      border-radius: 4px;
      margin-bottom: 10px;
    }
    .close-panel {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      border: none;
      font-size: 1.5rem;
      color: #333;
      cursor: pointer;
    }
    .social-links a {
      margin-right: 10px;
      font-size: 0.9rem;
    }

    /* ---------- Reward Panel ---------- */
    .reward-panel {
      background: #fff;
      padding: 15px;
      border-radius: 4px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    /* ---------- Read-only Summary ---------- */
    .summary-block {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      background: #f7f7f7;
      margin-bottom: 10px;
    }

    /* ---------- Profile View ---------- */
    #profileView .profile-info {
      text-align: center;
    }
    #profileView .profile-info img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      border: 1px solid #ccc;
      margin-bottom: 10px;
    }
    #profileView .profile-info h2 {
      margin-bottom: 5px;
    }
    #profileView .profile-info p {
      color: #666;
    }

    /* ---------- Responsive Adjustments ---------- */
    @media (max-width: 480px) {
      .candidate-block { width: 100px; }
      .bottom-nav button { font-size: 0.8rem; }
    }
  </style>
</head>
<body>

  <!-- Voting / Election Views -->
  <div id="electionView" class="view active">
    <div class="container">
      <h1>Available Elections</h1>
      <div id="electionList">
        <!-- Election blocks injected here -->
      </div>
    </div>
  </div>

  <div id="positionView" class="view">
    <div class="container">
      <h1 id="positionElectionTitle"></h1>
      <div id="positionBlock">
        <!-- Position block info injected here -->
      </div>
      <div class="position-nav">
        <button class="btn" id="skipBtn" onclick="skipPosition()">Skip Position</button>
        <button class="btn" id="exitElectionBtn" onclick="exitElection()">Exit Election</button>
      </div>
    </div>
  </div>

  <div id="reviewView" class="view">
    <div class="container">
      <h1>Your Election Choices</h1>
      <div id="reviewSummary">
        <!-- Summary injected here -->
      </div>
      <button class="btn" onclick="backToElections()">Back to Elections</button>
    </div>
  </div>

  <!-- Profile View -->
  <div id="profileView" class="view">
    <div class="container profile-info">
      <img src="https://via.placeholder.com/100" alt="User Avatar">
      <h2>User123</h2>
      <p>Welcome to your profile! Rewards earned from elections will be displayed here.</p>
      <p>(This is a demo profile page.)</p>
    </div>
  </div>

  <!-- Candidate Panel Overlay -->
  <div id="candidateOverlay" class="overlay">
    <div class="candidate-panel">
      <button class="close-panel" onclick="closeCandidatePanel()">×</button>
      <img id="candidateImage" src="" alt="Candidate Image">
      <h2 id="candidateName"></h2>
      <p><strong>Manifesto:</strong> <span id="candidateManifesto"></span></p>
      <p><strong>AI Summary:</strong> <span id="candidateAISummary"></span></p>
      <div class="social-links" id="candidateSocial"></div>
      <button class="btn" onclick="voteForCandidate()">Vote for this Candidate</button>
    </div>
  </div>

  <!-- Reward Panel Overlay -->
  <div id="rewardOverlay" class="overlay">
    <div class="reward-panel">
      <h2>Congratulations!</h2>
      <p>You earned a reward for voting on this position.</p>
      <button class="btn" onclick="rewardConfirmed()">Okay</button>
    </div>
  </div>

  <!-- Bottom Navigation Bar -->
  <div class="bottom-nav">
    <button id="navVoting" class="active" onclick="showPrimaryView('electionView')">
      <!-- Simple SVG icon for Voting -->
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14l4-4h12c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/>
      </svg>
      Voting
    </button>
    <button id="navProfile" onclick="showPrimaryView('profileView')">
      <!-- Simple SVG icon for Profile -->
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v3h20v-3c0-3.3-6.7-5-10-5z"/>
      </svg>
      Profile
    </button>
  </div>

  <script>
    /* ----- Sample Data ----- */
    const elections = [
      {
        id: 1,
        institution: "University Student Council",
        timeRemaining: "2 days 5 hrs",
        positionsCount: 2,
        reward: "Free Coffee Voucher",
        positions: [
          {
            id: 101,
            title: "President",
            info: "The President oversees all council operations.",
            moreInfoLink: "#",
            candidates: [
              {
                id: 1001,
                name: "Alice Johnson",
                image: "https://via.placeholder.com/150?text=Alice",
                manifesto: "Better campus facilities and student support.",
                aiSummary: "Focus on improved infrastructure and welfare.",
                social: { twitter: "#", linkedin: "#" },
                bestChoice: true
              },
              {
                id: 1002,
                name: "Bob Smith",
                image: "https://via.placeholder.com/150?text=Bob",
                manifesto: "Transparency and student empowerment.",
                aiSummary: "Emphasizes accountability and active participation.",
                social: { twitter: "#", linkedin: "#" },
                bestChoice: false
              }
            ],
            vote: null
          },
          {
            id: 102,
            title: "Vice President",
            info: "Supports the President and manages specific projects.",
            moreInfoLink: "#",
            candidates: [
              {
                id: 1003,
                name: "Carol White",
                image: "https://via.placeholder.com/150?text=Carol",
                manifesto: "Innovative projects for community engagement.",
                aiSummary: "Strong focus on community and innovation.",
                social: { twitter: "#", linkedin: "#" },
                bestChoice: false
              },
              {
                id: 1004,
                name: "David Lee",
                image: "https://via.placeholder.com/150?text=David",
                manifesto: "Commitment to student representation.",
                aiSummary: "Highlights dedication and representation.",
                social: { twitter: "#", linkedin: "#" },
                bestChoice: true
              }
            ],
            vote: null
          }
        ]
      }
      // Additional elections can be added here...
    ];

    /* ----- Global State ----- */
    let currentElection = null;
    let currentPositionIndex = 0;
    let selectedCandidate = null;

    /* ----- Initialization ----- */
    document.addEventListener("DOMContentLoaded", () => {
      renderElectionList();
    });

    /* ----- Primary View Switcher ----- */
    function showPrimaryView(viewId) {
      // Hide any subviews (position, review) if switching to main voting view
      if (viewId === 'electionView') {
        // Ensure the election view is active and set the navigation buttons
        showView('electionView');
      } else if (viewId === 'profileView') {
        showView('profileView');
      }
      // Update bottom nav active state
      document.getElementById("navVoting").classList.toggle("active", viewId === 'electionView');
      document.getElementById("navProfile").classList.toggle("active", viewId === 'profileView');
    }

    /* ----- View Rendering Functions ----- */
    function renderElectionList() {
      const electionList = document.getElementById("electionList");
      electionList.innerHTML = "";
      elections.forEach(election => {
        const block = document.createElement("div");
        block.className = "election-block";
        block.onclick = () => startElection(election.id);
        block.innerHTML = `
          <h2>${election.institution}</h2>
          <p><strong>Time:</strong> ${election.timeRemaining}</p>
          <p><strong>Positions:</strong> ${election.positionsCount}</p>
          <p><strong>Reward:</strong> ${election.reward}</p>
        `;
        electionList.appendChild(block);
      });
    }

    function startElection(electionId) {
      currentElection = elections.find(e => e.id === electionId);
      currentPositionIndex = 0;
      selectedCandidate = null;
      document.getElementById("positionElectionTitle").textContent = currentElection.institution;
      showView("positionView");
      renderCurrentPosition();
    }

    function renderCurrentPosition() {
      const posContainer = document.getElementById("positionBlock");
      posContainer.innerHTML = "";
      if (currentPositionIndex >= currentElection.positions.length) {
        renderReviewSummary();
        showView("reviewView");
        return;
      }
      const position = currentElection.positions[currentPositionIndex];
      const posBlock = document.createElement("div");
      posBlock.className = "position-block";
      posBlock.innerHTML = `
        <div class="position-info">
          <h2>Position: ${position.title}</h2>
          <p>${position.info}</p>
          <a href="${position.moreInfoLink}" target="_blank">More Info</a>
        </div>
        <div class="candidates" id="candidatesContainer">
          <!-- Candidate blocks go here -->
        </div>
        <div id="voteConfirmation" style="margin-top:10px;"></div>
      `;
      posContainer.appendChild(posBlock);
      renderCandidates(position.candidates);
    }

    function renderCandidates(candidates) {
      const container = document.getElementById("candidatesContainer");
      container.innerHTML = "";
      candidates.forEach(candidate => {
        const candidateDiv = document.createElement("div");
        candidateDiv.className = "candidate-block";
        candidateDiv.onclick = () => openCandidatePanel(candidate);
        candidateDiv.innerHTML = `
          <img src="${candidate.image}" alt="${candidate.name}">
          <p>${candidate.name}</p>
          ${candidate.bestChoice ? '<div class="best-choice">★</div>' : ""}
        `;
        container.appendChild(candidateDiv);
      });
    }

    /* ----- Candidate Panel Functions ----- */
    function openCandidatePanel(candidate) {
      selectedCandidate = candidate;
      document.getElementById("candidateImage").src = candidate.image;
      document.getElementById("candidateName").textContent = candidate.name;
      document.getElementById("candidateManifesto").textContent = candidate.manifesto;
      document.getElementById("candidateAISummary").textContent = candidate.aiSummary;
      const socialDiv = document.getElementById("candidateSocial");
      socialDiv.innerHTML = "";
      for (const [platform, link] of Object.entries(candidate.social)) {
        const anchor = document.createElement("a");
        anchor.href = link;
        anchor.textContent = platform;
        anchor.target = "_blank";
        socialDiv.appendChild(anchor);
      }
      document.getElementById("candidateOverlay").classList.add("active");
    }

    function closeCandidatePanel() {
      document.getElementById("candidateOverlay").classList.remove("active");
    }

    function voteForCandidate() {
      const position = currentElection.positions[currentPositionIndex];
      position.vote = selectedCandidate;
      closeCandidatePanel();
      const voteConf = document.getElementById("voteConfirmation");
      voteConf.innerHTML = `<p>You selected <strong>${selectedCandidate.name}</strong> for ${position.title}.</p>
                            <button class="btn" onclick="confirmVote()">Confirm Vote</button>`;
    }

    function confirmVote() {
      document.getElementById("rewardOverlay").classList.add("active");
    }

    /* ----- Reward Panel Confirmation ----- */
    function rewardConfirmed() {
      document.getElementById("rewardOverlay").classList.remove("active");
      currentPositionIndex++;
      selectedCandidate = null;
      renderCurrentPosition();
    }

    /* ----- Skip or Exit Functions ----- */
    function skipPosition() {
      currentElection.positions[currentPositionIndex].vote = "Skipped";
      currentPositionIndex++;
      selectedCandidate = null;
      renderCurrentPosition();
    }

    function exitElection() {
      alert("Exiting election. Your progress has been saved.");
      showView("electionView");
    }

    /* ----- Review Summary ----- */
    function renderReviewSummary() {
      const reviewContainer = document.getElementById("reviewSummary");
      reviewContainer.innerHTML = "";
      currentElection.positions.forEach(position => {
        const summary = document.createElement("div");
        summary.className = "summary-block";
        summary.innerHTML = `<h3>${position.title}</h3>
                             <p><strong>Your Choice:</strong> ${position.vote ? (typeof position.vote === "object" ? position.vote.name : position.vote) : "No vote"}</p>`;
        reviewContainer.appendChild(summary);
      });
    }

    function backToElections() {
      currentElection = null;
      currentPositionIndex = 0;
      selectedCandidate = null;
      showView("electionView");
    }

    /* ----- Helper: Generic View Switcher ----- */
    function showView(viewId) {
      document.querySelectorAll(".view").forEach(view => view.classList.remove("active"));
      document.getElementById(viewId).classList.add("active");
    }
  </script>
</body>
</html>
